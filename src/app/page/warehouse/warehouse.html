<div class="warehouse-page">
  
  <div class="page-header">
    <div class="header-left">
      <h2>Qu·∫£n l√Ω kho v·∫≠n</h2>
      <p class="subtitle">Theo d√µi t·ªìn kho v√† l·ªãch s·ª≠ xu·∫•t nh·∫≠p</p>
    </div>
    
    <div class="search-box">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input type="text" [(ngModel)]="searchKeyword" (keyup)="search()" placeholder="T√¨m t√™n s·∫£n ph·∫©m..." />
    </div>
  </div>

  <div class="table-container fade-in">
  <table class="modern-table">
    <thead>
      <tr>
        <th>S·∫£n ph·∫©m</th>
        <th>Danh m·ª•c</th>
        <th style="text-align: center;">T·ªìn kho</th>
        <th style="text-align: center; min-width: 140px;">Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of filteredProducts">
        <td>
          <div class="prod-info">
            <div class="prod-icon">üì¶</div>
            <div class="prod-text">
              <span class="prod-name">{{ p.name }}</span>
              <small style="color:#888; font-size:11px;">ID: {{p.id}}</small>
            </div>
          </div>
        </td>
        <td>{{ p.category?.name || '---' }}</td>
        
        <td style="text-align: center;">
          <span class="stock-badge" [class.low]="p.stock < 10" [class.out]="p.stock === 0">
            {{ p.stock }}
          </span>
        </td>

        <td class="actions-cell">
          <button class="btn-icon btn-import" (click)="openAdjust(p, 'IMPORT')" title="Nh·∫≠p kho">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
          </button>

          <button class="btn-icon btn-export" (click)="openAdjust(p, 'EXPORT')" title="Xu·∫•t kho">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
          </button>
          
          <button class="btn-icon btn-history" (click)="openHistory(p)" title="L·ªãch s·ª≠">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

  <div class="modal-overlay" *ngIf="showHistoryModal" (click)="closeModals()">
    <div class="modal-card lg" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>L·ªãch s·ª≠ kho: {{ selectedProduct?.name }}</h3>
        <button class="close-btn" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body scrollable">
        <table class="history-table">
          <thead>
            <tr>
              <th>Th·ªùi gian</th>
              <th>Lo·∫°i</th>
              <th>Thay ƒë·ªïi</th>
              <th>T·ªìn sau ƒë√≥</th>
              <th>Ghi ch√∫</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of logs">
              <td class="time">{{ log.createdAt | date:'dd/MM/yy HH:mm' }}</td>
              <td>
                <span class="type-badge" [ngClass]="getTypeClass(log.type)">{{ log.type }}</span>
              </td>
              <td [class.plus]="log.changeAmount > 0" [class.minus]="log.changeAmount < 0" style="font-weight: bold;">
                {{ log.changeAmount > 0 ? '+' : '' }}{{ log.changeAmount }}
              </td>
              <td>{{ log.balanceAfter }}</td>
              <td class="note">{{ log.note || '---' }}</td>
            </tr>
            <tr *ngIf="logs.length === 0">
              <td colspan="5" style="text-align: center; color: #999;">Ch∆∞a c√≥ l·ªãch s·ª≠ bi·∫øn ƒë·ªông.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showAdjustModal" (click)="closeModals()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    
    <div class="modal-header" [ngClass]="currentTransactionType === 'IMPORT' ? 'header-import' : 'header-export'">
      <h3>
        <span *ngIf="currentTransactionType === 'IMPORT'">üì• Nh·∫≠p kho</span>
        <span *ngIf="currentTransactionType === 'EXPORT'">üì§ Xu·∫•t kho</span>
      </h3>
      <button class="close-btn" (click)="closeModals()">√ó</button>
    </div>

    <div class="modal-body">
      <p class="mb-2">S·∫£n ph·∫©m: <strong>{{ selectedProduct?.name }}</strong></p>
      <p class="mb-4">T·ªìn hi·ªán t·∫°i: <span class="badge-stock">{{ selectedProduct?.stock }}</span></p>

      <div class="form-group">
        <label>S·ªë l∆∞·ª£ng {{ currentTransactionType === 'IMPORT' ? 'nh·∫≠p th√™m' : 'xu·∫•t ƒëi' }}</label>
        <div class="input-with-btn">
          <button (click)="adjustForm.quantity = adjustForm.quantity > 1 ? adjustForm.quantity - 1 : 1">-</button>
          <input type="number" [(ngModel)]="adjustForm.quantity" min="1" class="text-center">
          <button (click)="adjustForm.quantity = adjustForm.quantity + 1">+</button>
        </div>
      </div>

      <div class="form-group">
        <label>Ghi ch√∫ (L√Ω do)</label>
        <textarea [(ngModel)]="adjustForm.note" rows="3" class="form-control" 
          [placeholder]="currentTransactionType === 'IMPORT' ? 'VD: Nh·∫≠p h√†ng t·ª´ NCC...' : 'VD: Xu·∫•t h·ªßy, h·ªèng...'">
        </textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModals()">H·ªßy</button>
      
      <button class="btn" 
              [ngClass]="currentTransactionType === 'IMPORT' ? 'btn-success' : 'btn-danger'" 
              (click)="submitAdjust()">
        X√°c nh·∫≠n {{ currentTransactionType === 'IMPORT' ? 'Nh·∫≠p' : 'Xu·∫•t' }}
      </button>
    </div>
  </div>
</div>

</div>