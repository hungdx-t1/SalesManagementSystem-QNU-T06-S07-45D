<div class="product-page-container">
  
  <div class="header-section">
    <div class="search-wrapper">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input type="text" 
             placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." 
             [(ngModel)]="searchKeyword" 
             (input)="onSearch()" />
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" *ngIf="showProductList" (click)="backToCategories()">
        ‚Üê Tr·ªü l·∫°i
      </button>
      <button class="btn btn-primary" (click)="openCreateCategory()">
        + Danh m·ª•c
      </button>
      <button class="btn btn-primary" (click)="openCreateProduct()">
        + S·∫£n ph·∫©m
      </button>
    </div>
  </div>

  <div class="section-title" *ngIf="showProductList">
    <h2>Danh m·ª•c: <span>{{ selectedCategoryName }}</span></h2>
  </div>

  <div class="grid-container" *ngIf="!showProductList">
    <div *ngFor="let cat of categories" class="card category-card" (click)="openProducts(cat)">
      <div class="card-icon">üìÅ</div>
      <div class="card-info">
        <h3>{{ cat.name }}</h3>
        <span class="subtitle">Nh·∫•n ƒë·ªÉ xem s·∫£n ph·∫©m</span>
      </div>
      <div class="card-actions">
        <button class="icon-btn edit" (click)="openEditCategory(cat); $event.stopPropagation()" title="S·ª≠a">
          <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
        </button>
        <button class="icon-btn delete" (click)="deleteCategory(cat.id); $event.stopPropagation()" title="X√≥a">
          <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
        </button>
      </div>
    </div>
  </div>

  <div class="list-container" *ngIf="showProductList">
    <div *ngFor="let p of filteredProducts" class="product-row">
      <div class="product-info">
        <div class="product-name">{{ p.name }}</div>
        <div class="product-meta">
          <span class="badge price">{{ p.price | currency:'VND' }}</span>
          <span class="badge stock">Kho: {{ p.stock }}</span>
        </div>
      </div>
      
      <div class="row-actions">
        <button class="icon-btn edit" (click)="openEditProduct(p)">
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
        </button>
        <button class="icon-btn delete" (click)="deleteProduct(p.id)">
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
        </button>
      </div>
    </div>
    
    <div *ngIf="filteredProducts.length === 0" class="empty-state">
      Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong danh m·ª•c n√†y.
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showProductForm || showCategoryForm">
    <div class="modal-content fade-in-up">
      <div class="modal-header">
        <h3>
          {{ showProductForm ? (isEditingProduct ? 'Ch·ªânh s·ª≠a s·∫£n ph·∫©m' : 'Th√™m s·∫£n ph·∫©m m·ªõi') 
                             : (isEditingCategory ? 'Ch·ªânh s·ª≠a danh m·ª•c' : 'Th√™m danh m·ª•c m·ªõi') }}
        </h3>
        <button class="close-btn" (click)="showProductForm ? closeProductForm() : closeCategoryForm()">√ó</button>
      </div>

      <form *ngIf="showProductForm" (ngSubmit)="submitProduct()" class="modal-form">
        <div class="form-group">
          <label>T√™n s·∫£n ph·∫©m</label>
          <input type="text" [(ngModel)]="productForm.name" name="name" required placeholder="Nh·∫≠p t√™n..." />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Gi√°</label>
            <input type="number" [(ngModel)]="productForm.price" name="price" required />
          </div>
          <div class="form-group">
            <label>S·ªë l∆∞·ª£ng</label>
            <input type="number" [(ngModel)]="productForm.stock" name="quantity" required />
          </div>
        </div>
        <div class="form-group">
          <label>Danh m·ª•c</label>
          <select [(ngModel)]="productForm.categoryId" name="categoryId" required>
            <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
          </select>
        </div>
        <div class="modal-actions">
          <button class="btn btn-text" type="button" (click)="closeProductForm()">H·ªßy b·ªè</button>
          <button class="btn btn-primary" type="submit">{{ isEditingProduct ? 'C·∫≠p nh·∫≠t' : 'T·∫°o m·ªõi' }}</button>
        </div>
      </form>

      <form *ngIf="showCategoryForm" (ngSubmit)="submitCategory()" class="modal-form">
        <div class="form-group">
          <label>T√™n danh m·ª•c</label>
          <input type="text" [(ngModel)]="categoryForm.name" name="catName" required placeholder="V√≠ d·ª•: ƒêi·ªán t·ª≠..." />
        </div>
        <div class="modal-actions">
          <button class="btn btn-text" type="button" (click)="closeCategoryForm()">H·ªßy b·ªè</button>
          <button class="btn btn-primary" type="submit">{{ isEditingCategory ? 'C·∫≠p nh·∫≠t' : 'T·∫°o m·ªõi' }}</button>
        </div>
      </form>

    </div>
  </div>

</div>